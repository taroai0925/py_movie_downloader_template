# はじめてのGoogle Drive自動化アプリ作成ガイド 🚀 

このガイドは、プログラミング経験が全くない方でも、自分専用のアプリを完成させられるように作られています。難しいことは全部「Cloud Shell」という魔法の箱がやってくれるので、安心してついてきてくださいね！

#### なぜ「Google Cloud Shell」を使うの？
一言でいうと、**「あなたのパソコンを汚さずに、無料でプロの開発環境が使えるから」**です。
料理に例えるなら、最新の調理器具がすべて揃った、ピカピカのレンタルキッチンを無料で使えるようなものです。後片付けも不要で、とっても便利！

## 目次:
- [ステップ1:主催者にgmailアドレスを連絡しよう！(約1分)](#%E3%82%B9%E3%83%86%E3%83%83%E3%83%971%E4%B8%BB%E5%82%AC%E8%80%85%E3%81%ABgmail%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%82%92%E9%80%A3%E7%B5%A1%E3%81%97%E3%82%88%E3%81%86%E7%B4%841%E5%88%86)
- [ステップ2：Google cloud shell にアクセスしよう!(約3分)](#%E3%82%B9%E3%83%86%E3%83%83%E3%83%972google-cloud-shell-%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%82%88%E3%81%86%E7%B4%843%E5%88%86)
- [ステップ3：魔法の箱に「アプリの素」をセットしよう!(約3分)](#%E3%82%B9%E3%83%86%E3%83%83%E3%83%973%E9%AD%94%E6%B3%95%E3%81%AE%E7%AE%B1%E3%81%AB%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E7%B4%A0%E3%82%92%E3%82%BB%E3%83%83%E3%83%88%E3%81%97%E3%82%88%E3%81%86%E7%B4%843%E5%88%86)
- [ステップ4：アプリとあなたのアカウントを「握手」させよう!(約3分)](#%E3%82%B9%E3%83%86%E3%83%83%E3%83%974%E3%82%A2%E3%83%97%E3%83%AA%E3%81%A8%E3%81%82%E3%81%AA%E3%81%9F%E3%81%AE%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%82%92%E6%8F%A1%E6%89%8B%E3%81%95%E3%81%9B%E3%82%88%E3%81%86%E7%B4%843%E5%88%86)
- [ステップ5：バイブコーディング前の確認作業をしよう!(約1分)](#%E3%82%B9%E3%83%86%E3%83%83%E3%83%975%E3%83%90%E3%82%A4%E3%83%96%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E5%89%8D%E3%81%AE%E7%A2%BA%E8%AA%8D%E4%BD%9C%E6%A5%AD%E3%82%92%E3%81%97%E3%82%88%E3%81%86%E7%B4%841%E5%88%86)
- [ステップ6：バイブコーディングの準備をしよう!(約3分)](#%E3%82%B9%E3%83%86%E3%83%83%E3%83%976%E3%83%90%E3%82%A4%E3%83%96%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E6%BA%96%E5%82%99%E3%82%92%E3%81%97%E3%82%88%E3%81%86%E7%B4%843%E5%88%86)
- [ステップ7：gemini-cliを使って、バイブコーディングしよう!(約3分)](#%E3%82%B9%E3%83%86%E3%83%83%E3%83%977gemini-cli%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%90%E3%82%A4%E3%83%96%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%97%E3%82%88%E3%81%86%E7%B4%843%E5%88%86)
- []()
- []()
- []()
- []()

---

### ステップ1:主催者にgmailアドレスを連絡しよう！(約1分)
事前のアンケートで、gmailアドレスを連絡してくださいと依頼がありますので、
gmailアドレスを連絡してください。
日ごろ利用しているものでも良いですし、不安を感じる場合は、新たに作っても良いでしょう。
連絡することで、以下の`ステップ4`の作業ができるようになります。 

---

### ステップ2：Google cloud shell にアクセスしよう!(約3分)
*   **作業内容:**
    1. ステップ1で主催者に連絡した、gmailアドレスでログインしているブラウザで行います。
    2. 下記URLをあなたのブラウザで開いてください。
    ```bash
    https://shell.cloud.google.com/?hl=ja&fromcloudshell=true&show=ide%2Cterminal
    ```
    3. クラウドシェルの認証が表示されたら、右下の認証をクリックします
    ![認証](img/cloudshell1.png)

    4. この画面がクラウドシェルです
    ![cloudshell](img/cloudshell2.png)

---

### ステップ3：魔法の箱に「アプリの素」をセットしよう!(約3分)
*   **作業内容:**
    1. まずは、私があらかじめ用意した **「アプリの素」** が詰まったzipファイルを、あなたのCloud Shellにアップロードしましょう。
    このzipファイルには、アプリの設計図や、Googleに挨拶するための **「身分証明書 (`credentials.json`)」** など、必要なものが全て入っています。
    2. 以下のリンクから`py_movie_donwloader_template.zip`というファイルを、あなたのパソコンにダウンロードします。
    [py_movie_donwloader_template.zip ダウンロード](https://github.com/sinzy0925/py_movie_downloader_template/raw/refs/heads/main/img/py_movie_downloader_template.zip)

    3.  次に、Cloud Shellを開き、画面右上の**さらに表示メニュー（︙）** から「**アップロード**」を選択して、今ダウンロードした`py_movie_donwloader_template.zip`をアップロードします。

    4.  最後に、以下のコマンドを実行して、zipファイルを解凍（展開）し、準備を完了させます。
        ```bash
        unzip py_movie_donwloader_template.zip && cd py_movie_donwloader_template
        ```

> **ポイント：**
> この`unzip`というコマンドは、「魔法の箱を開けて、中身を取り出して！」というおまじないのようなものです。これを実行するだけで、アプリ作りの準備が全部整います。

---

### ステップ4：アプリとあなたのアカウントを「握手」させよう!(約3分)

次に、このアプリに対して、あなた自身が「私のGoogle DriveにアクセスしてOKですよ」という**許可**を与える必要があります。
この「握手」の儀式を行うのが、`a00_start.py`というスクリプトの役目です。

*   **作業内容:**
    1.  まず、アプリに必要な部品（ライブラリ）をインストールします。以下のコマンドを実行してください。
    ```bash
    pip install -r requirements.txt
    ```
    2.  次に、以下のコマンドで「握手」を開始します。
    ```bash
    python a00_start.py
    ```
    3.  画面に長いURLが表示されるので、それをコピーしてブラウザで開きます。
    4.  見慣れたGoogleのログイン画面が表示されるので、ログインして「**許可**」をクリックします。
    5.  ブラウザに「認証コード」が表示されたら、それをコピーして、Cloud Shellの画面に貼り付けてEnterキーを押します。

*   **何が起きるの？**
    この「握手」が成功すると、その証として **`token.json`** という特別な **「合鍵」** が自動的に作られます。
    これ以降、アプリはこの「合鍵」を使って、あなたのGoogle Driveに安全にアクセスできるようになります。

    `「★★★ 認証が正常に完了しました！ ★★★」`と表示されたら、このステップは成功です！

---

### ステップ5：バイブコーディング前の確認作業をしよう!(約1分)
*   **作業内容:**
    1. 以下のコマンドを入力して、エンターキーを押してください。
    ```bash
    python m01_google_drive_manager.py
    ```
    2. エラーがでたら、ＯＫです。

---

### ステップ6：バイブコーディングの準備をしよう!(約3分)
*   **作業内容:**

    1. 今回は非常に簡単な例でバイブコーディングします。
    2. まず、自分のgoogleドライブをブラウザで開き、フォルダを作成します。
    3. フォルダの共有設定をして、だれからでもアクセスできるようにします。
    4. フォルダのURLのfolders/以降の文字列をコピーします
    　　https://drive.google.com/drive/folders/1h9NQgOxpxk　なら、1h9NQgOxpxk をコピーします。
    5. このフォルダに、拡張子がmp4の動画ファイルを入れておきましょう。あとで、この動画ファイルを文字起こしします。　入れる動画ファイルが無ければ、サンプルとして以下の動画ファイルをダウンロードして入れてください。

---

### ステップ7：gemini-cliを使って、バイブコーディングしよう!(約3分)
*   **作業内容:**
    1.  以下のコマンドでgemini を起動します
    ```bash
    gemini
    ```
    2. 初めての人は、ログインを求められますので、いつも使うのと同じgoogleアカウントでログインしてください。
    3. 以下の命令をgeminiに貼り付け、エンターキーを押します。
    　　@m01_google_drive_manager.py の'SHARED_DRIVE_FOLDER_ID'の値を'1h9NQgOxpxk'に変更してください。
    4. geminiから、修正しても良いですかと英語で聞かれますので、エンターキーを押してください。

---

### ステップ8：gemini-cliを終了して、アプリを実行します。(約3分)
*   **作業内容:**
    1. gemini-cliを終了しますので、「Ctrl + c」を数回入力してください。
    2. 以下のコマンドを入力して、アプリを実行します。
    ```bash
    python m01_google_drive_manager.py
    ```
>    ヒント: 
>    gemini-cliを終了せずに、gemini-cliに実行させる方法もあります。処理が遅いので上記では自分でアプリを実行しています。gemini-cliに実行してもらう命令方法はこれです。
「m01_google_drive_manager.pyを実行して」

---

### ステップ9以降：[オプション作業]全てのアプリを自動実行して、動画ファイルから文字起こししてマガジンを作ります。


### ステップ9：[オプション作業]gemini-apiを活用して、音声ファイルを文字起こしするために、geminiのAPIキーを取得します。
*   **作業内容:**
    全てのアプリを実行するには、更にいくつか作業が必要です。
    1. Google ai studio で、geminiのAPIキーを取得します。
    ```bash
    https://aistudio.google.com/app/apikey
    ```
    2. 同意画面が表示される方は、同意してください。
    ![同意](img/apikey1.png)

    3. 画面右上の、「＋ APIキーを作成」をクリックしてください。
    ![APIキー作成](img/apikey2.png)

    4. APIキーが生成されたので、中央のコピーボタンをクリックしてください。
    ![APIキーコピー](img/apikey3.png)


---

---

### ステップ10： [オプション作業]APIキーをアプリから活用するための設定をします。
*   **作業内容:**
    1. クラウドシェルのエディター画面を開きます。
    2. 画面上部のFileをクリックし、Open Folderをクリックします。
    ![openfolder1](img/openfolder1.png)
    3. スクロールして、py_movie_donwloader_templateをクリックします。
    ![openfolder2](img/openfolder2.png)
    4. エディタ画面が開くと、以下を確認してください。
    - py_movie_donwloader_templateが開かれていること。
    - env_templateがあること。
    ![openfolder3](img/openfolder3.png)
    5. env_templateをクリックして、上記ステップ9でコピーしたAPIキーを貼り付け、「Ctrl + s」を押します。
    ```bash
    GOOGLE_API_KEY_1="apiキーを貼り付ける場所"
    ```
    6. この状態では、gemini-apiがapiキーを読み込めないので、読み込めるように設定します。
    ```bash
    cp env_template .env
    ```
    7. 動画ファイルを音声ファイルに変換し、４分単位に分割するツールffmpegをインストールします。
    ```bash
    sudo apt-get update
    sudo apt-get install -y ffmpeg
    ```

---

### ステップ11： [オプション作業]全てのアプリを自動実行して、動画ファイルから文字起こししてマガジンを作ります。
*   **作業内容:**
    1. 以下のコマンドを実行してください。
    ```bash
    python m00_main_mojiokosi.py
    ```
    2. m00_main_mojiokosi.py が行っている処理概要
    ```bash
    m01_google_drive_manager.py: googleドライブから動画ファイルをダウンロードする
    m02_ffmpeg.py: ダウンロードした動画ファイルを音声ファイルに変換し、４分単位に分割する。
    m03_gemini_transcript1.py: 分割された音声ファイルを文字起こしする。
    m03_gemini_transcript2.py: 文字起こしファイルを読みやすく編集し、マガジンに再編集する。
    ```
    3. 文字起こし情報を確認しよう！
    split_m4aフォルダを確認します。
    ‐ `z1_combined.txt`は、単純に文字起こししたものです。
    - `z2_combined.txt`は、単純文字起こしを読みやすくしたものです。
    - `z3_combined.md`は、マガジン化したものです。

### ステップ12： [オプション作業]Github actionsで、全てのアプリを自動実行して、動画ファイルから文字起こししてマガジンを作る作業を実行します。
*   **作業内容:**
    github のアカウント作成から、github actions 実行までを説明すると１時間以上かかりますので、割愛します。github のアカウントがあり、githubに、pushしたところから説明します。
    
    1. pushしたリポジトリを開く
    ```bash
    https://github.com/taroai0925/py_movie_downloader_template
    ```
    2. Actions というタブをクリックする
    3. 画面左の中央より少し上の、`Manual Transcript Workflow`をクリックする
    4. 画面右の中央の、`Run Workflow`をクリックする
    5. すぐ下に表示される緑色の`Run Workflow`をクリックする
    6. github actions で実行されます。
    7. 数分後に　上記2のActions を再度クリックしたら、


